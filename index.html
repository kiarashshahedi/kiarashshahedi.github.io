<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page with Firebase</title>
</head>
<body>
    <h1>Welcome to My Page</h1>
    
    <!-- View Counter -->
    <h3>Page Views: <span id="viewCount">Loading...</span></h3>

    <!-- Review Form -->
    <form id="reviewForm">
        <h2>Leave a Review</h2>
        <input type="text" id="reviewName" placeholder="Your Name" required><br><br>
        <textarea id="reviewText" placeholder="Your Review" required></textarea><br><br>
        <input type="number" id="reviewRating" min="1" max="5" placeholder="Rating (1-5)" required><br><br>
        <button type="submit">Submit Review</button>
    </form>

    <!-- Reviews Section -->
    <h2>Reviews:</h2>
    <div id="reviewsContainer">
        Loading reviews...
    </div>

    <!-- Firebase Integration -->
    <script type="module">
        // Import Firebase dependencies
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getDatabase, ref, onValue, push, update, increment } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA02GTMGPHPvT1QcsvtYE2HslYRrl8y9ks",
            authDomain: "kiarashshahedi-github-io.firebaseapp.com",
            databaseURL: "https://kiarashshahedi-github-io-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kiarashshahedi-github-io",
            storageBucket: "kiarashshahedi-github-io.appspot.com",
            messagingSenderId: "545043533329",
            appId: "1:545043533329:web:36710cb038ea645114abb0",
            measurementId: "G-2WSLLJNHFW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Page View Counter
        const pageViewsRef = ref(db, 'pageViews');
        
        // Increment page views on page load
        update(pageViewsRef, {
            count: increment(1)
        });

        // Display updated page views in the HTML
        onValue(pageViewsRef, (snapshot) => {
            const data = snapshot.val();
            if (data && data.count) {
                document.getElementById('viewCount').innerText = data.count;
            }
        });

        // Submit Review
        document.getElementById('reviewForm').addEventListener('submit', function (e) {
            e.preventDefault();
            
            const name = document.getElementById('reviewName').value;
            const review = document.getElementById('reviewText').value;
            const rating = document.getElementById('reviewRating').value;

            // Reference to the reviews in the database
            const reviewsRef = ref(db, 'reviews');

            // Push new review
            push(reviewsRef, {
                name: name,
                review: review,
                rating: rating,
                timestamp: new Date().toISOString()
            }).then(() => {
                alert('Review submitted!');
                document.getElementById('reviewForm').reset();
            });
        });

        // Display Reviews
        const reviewsContainer = document.getElementById('reviewsContainer');
        const reviewsRef = ref(db, 'reviews');

        // Fetch and display reviews
        onValue(reviewsRef, (snapshot) => {
            reviewsContainer.innerHTML = ''; // Clear previous reviews
            snapshot.forEach((reviewSnapshot) => {
                const review = reviewSnapshot.val();
                const reviewElement = `
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">${review.name}</h5>
                            <p class="card-text">${review.review}</p>
                            <p class="card-text">Rating: ${review.rating}/5</p>
                            <small class="text-muted">${new Date(review.timestamp).toLocaleString()}</small>
                        </div>
                    </div>
                `;
                reviewsContainer.innerHTML += reviewElement;
            });
        });
    </script>
</body>
</html>
